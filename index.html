<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
  <title>AR Vizitka — Chata</title>
  <!-- MindAR + Three.js CDNs -->
  <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.152.2/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.4/dist/mindar-image-three.prod.js"></script>
  <style>
    html, body {height:100%; margin:0; font-family:Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial;}
    #ar-container {position:relative; width:100%; height:100vh; background:#000; overflow:hidden;}
    #ui {position:absolute; left:12px; top:12px; color:#fff; z-index:3;}
    #qr-hint {position:absolute; right:12px; bottom:12px; background:rgba(255,255,255,0.9); padding:8px; border-radius:6px; z-index:3;}
    .note {background:rgba(0,0,0,0.45); padding:6px; border-radius:6px;}
  </style>
</head>
<body>
  <div id="ar-container">
    <div id="ui"><div class="note">Namiřte kameru na vizitku s chatou a povolte přístup ke kameře.</div></div>
    <div id="qr-hint">QR kód na kartě otevírá tuto stránku</div>
    <div id="mindar-container"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // Inicializace MindAR
      const mindarThree = new window.MINDAR.IMAGE.MindARThree({
        container: document.querySelector('#mindar-container'),
        imageTargetSrc: './targets.mind', // Vygenerovaný dataset z mapping.png
        maxTrack: 1,
      });

      const {renderer, scene, camera} = mindarThree;

      // Osvětlení
      const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1.2);
      scene.add(light);

      // Kotva pro AR objekt
      const anchor = mindarThree.addAnchor(0);

      // Načtení modelu chaty
      const loader = new THREE.GLTFLoader();
      loader.load('./chata.glb', (gltf) => {
        const model = gltf.scene;
        model.scale.set(0.15, 0.15, 0.15);
        model.position.set(0, 0, 0);
        model.rotation.set(0, Math.PI, 0);
        anchor.group.add(model);
      }, undefined, (err) => {
        console.warn('Chyba při načítání modelu GLB:', err);
      });

      // Start AR
      await mindarThree.start();

      // Smyčka vykreslování
      renderer.setAnimationLoop(() => {
        renderer.render(scene, camera);
      });

      // Ukončení kamery při odchodu
      window.addEventListener('beforeunload', async () => {
        await mindarThree.stop();
      });
    });
  </script>

  <!-- Poznámky:
    1. Soubor mapping.png použijte k vytvoření targets.mind pomocí MindAR Image Target Generator.
    2. Všechny soubory (index.html, chata.glb, mapping.png, targets.mind) hostujte na HTTPS.
    3. QR kód na vizitce musí směřovat na tuto stránku (např. https://tvoje-domena.cz/index.html).
    4. Funkční v prohlížečích Chrome/Safari s podporou WebXR a kamery.
  -->
</body>
</html>
